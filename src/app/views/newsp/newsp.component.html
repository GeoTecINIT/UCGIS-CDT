<div class="animated fadeIn">
  <h1 class="title">{{ title }}</h1>
  <div class="row">
    <div class="col-sm-12 col-md-12">
      <div class="card card-accent-primary">
        <div class="card-header">
          <div class="row">
            <div *ngIf="userOrgs.length == 0" class="col-sm-12 col-md-12">
              <button type="button" class="btn btn-block btn-link text-secondary" routerLink="/organization">
                &nbsp;You need to join or create an organization before you can save an educational offer.
              </button>
            </div>
            <div *ngIf="userOrgs.length > 0" class="col-md-9 text-center mb-3">

              <div class="btn-group" dropdown>
                <button id="button-animated" dropdownToggle type="button"
                  class="btn btn-pill btn-primary dropdown-toggle" aria-controls="dropdown-animated">
                  <i class="fa fa-plus"></i> Create new <span class="caret"></span>
                </button>
                <ul id="dropdown-animated" *dropdownMenu class="dropdown-menu" role="menu"
                  aria-labelledby="button-animated">
                  <li role="menuitem"><a class="dropdown-item pt-2 pb-2"
                      [ngClass]="{'disabled': currentTreeNode && currentTreeNode.data.depth>=0}"
                      (click)="addNodeInTree(0)">Study
                      Program</a></li>
                  <li role="menuitem"><a class="dropdown-item pt-2 pb-2"
                      [ngClass]="{'disabled': currentTreeNode && currentTreeNode.data.depth>=1}"
                      (click)="addNodeInTree(1)">Module</a></li>
                  <li role="menuitem"><a class="dropdown-item pt-2 pb-2"
                      [ngClass]="{'disabled': currentTreeNode && currentTreeNode.data.depth>=2}"
                      (click)="addNodeInTree(2)">Course</a></li>
                  <li role="menuitem"><a class="dropdown-item pt-2 pb-2"
                      [ngClass]="{'disabled': currentTreeNode && currentTreeNode.data.depth>=3}"
                      (click)="addNodeInTree(3)">Lecture</a>
                  </li>
                </ul>
              </div>

              <button type="submit" class="btn btn-pill btn-primary"
                (click)="isSearchingExisting = !isSearchingExisting; isSearchingSpecific = false"
                [hidden]="!currentTreeNode || currentTreeNode.data.depth == 3">
                <i class="fa fa-search"></i> Explore existing educational offers
                <!-- {{textByDepth}}s -->
              </button>

              <button type="submit" class="btn btn-pill btn-danger" (click)="removeNodeInTree()"
                [hidden]="!currentTreeNode || currentTreeNode.parent == null">
                <i class="fa fa-minus"></i> Remove {{textByDepthRemove}}
              </button>
            </div>
            <div *ngIf="userOrgs.length > 0" class="col-sm-6 col-md-3 text-right">
              <!-- <div>{{textSaved}}</div>-->
              <button type="submit" class="btn btn-pill btn-primary" (click)="saveStudyProgram()"
                [hidden]="!currentTreeNode" [ngClass]="{'success': isSaved}">
                <i class="fa fa-save"></i> Save
              </button>
              <button type="submit" class="btn btn-pill btn-primary" (click)="saveStudyProgram()" routerLink="/list"
                [hidden]="!currentTreeNode">
                <i class="icon-home"></i> Save and Exit
              </button>
            </div>

          </div>

          <div class="row" [hidden]="!currentTreeNode">
            <div class="col-sm-6 col-md-3">

              <p *ngIf="userOrgs.length > 0" class="text-primary text-right"> <span
                  style="display:inline-table; margin:2px"
                  tooltip="You can select an organization if you are member of it. Select a division or leave it empty. Division is not compulsory but it's useful to have the content organized."
                  class="badge badge-primary badge-pill">i</span>Save under organization </p>
            </div>
            <div class="col-sm-6 col-md-3">
              <ng-select *ngIf="userOrgs.length > 0 && userOrgs.length == currentUser.organizations.length"
                [items]="userOrgs" name="userOrgs" bindLabel="name" [multiple]="false" [(ngModel)]="saveOrg"
                (change)="isSaved = false; loadDivisions()">
                <ng-template ng-optgroup-tmp let-item="item">
                  {{item.name}}
                </ng-template>
              </ng-select>
            </div>
            <div class="col-sm-6 col-md-1">
              <p *ngIf="userOrgs.length > 0" class="text-primary text-right"> division </p>
            </div>
            <div class="col-sm-6 col-md-2">
              <ng-select *ngIf="userDivisions.length > 0" [items]="userDivisions" name="userDivisions" bindLabel="name"
                [multiple]="false" [(ngModel)]="saveDiv" (change)="isSaved = false">
                <ng-template ng-optgroup-tmp let-item="item">
                  {{item}}
                </ng-template>
              </ng-select>

            </div>
            <div *ngIf="userOrgs.length == 0" class="col-sm-12 col-md-12">
              <button type="button" class="btn btn-block btn-link text-secondary" routerLink="/organization">
                &nbsp;You need to join or create an organization before you can save an educational offer.
              </button>
            </div>
            <div *ngIf="userOrgs.length > 0" class="col-sm-6 col-md-3" style="display: inline-flex"
              [hidden]="!currentTreeNode">
              <span class="input-group-prepend">
                <div class="pr-1"> Visibility: Private </div>
                <label class="switch switch-label switch-pill switch-outline-primary-alt">
                  <input class="switch-input" type="checkbox" [(ngModel)]="levelPublic" (change)="isSaved = false"
                    name="levelPublic" />
                  <span class="switch-slider" data-checked="âœ“" data-unchecked="X"></span>
                </label>
                <div class="pl-1">Public</div>
              </span>
              <span style="display:inline-table; margin:2px"
                tooltip="If visibility is private, users in this organization can still see it. But users not logged in won't be able to see it. Visibility by default is public."
                class="badge badge-primary badge-pill"
                style="height: fit-content;">i</span>
            </div>

          </div>
          <div class="row">
            <div class="col-md-12">
              <p class="text-center text-danger"> {{otherUserEditingWarningText}} </p>
            </div>
          </div>
        </div>
        <!-- card body -->
        <div class="card-body">
          <div class="row" (window:resize)="onResize()">
            <div class="col-md-6" #graphTreeDiv (click)="refreshCurrentNode()" [hidden]="!currentTreeNode">
              <div class="card card-accent-secondary">
                <div class="card-header">
                  <label>General view</label>
                  <span tooltip="Click on any node to see more information about the module, course or lecture."
                    class="badge badge-primary badge-pill">i</span>
                  <button class="btn btn-link float-right pull-right"
                    (click)="graphTreeDiv.classList.contains('col-md-12') ? graphTreeDiv.className = 'col-md-6' : graphTreeDiv.className = 'col-md-12'; refreshTreeSize()">
                    <i class="float-right pull-right fa "
                      [ngClass]="{'fa-window-minimize': graphTreeDiv?.classList.contains('col-md-12'), 'fa-window-maximize': graphTreeDiv?.classList.contains('col-md-6')}"></i>
                  </button>
                  <div id="graphTree"></div>
                </div>
              </div>
            </div>
            <div *ngIf="currentTreeNode && (model || modelModule || modelCourse || modelLecture)" class="col-md-6"
              #NodeDiv>
              <!-- depth = 0 -> general info card -->
              <div *ngIf="!isSearchingExisting && currentTreeNode.data.depth == 0 && !isSearchingSpecific">
                <!--               <form #newOPForm="ngForm"> -->
                <div class="card card-accent-secondary">
                  <div class="card-header">
                    Study Program Information
                    <span
                      tooltip="Fill in here your Study Program information. To link BoK concepts to your content click on the link BoK buttons."
                      class="badge badge-primary badge-pill">i</span>

                    <button class="btn btn-link float-right pull-right"
                      (click)="NodeDiv.classList.contains('col-md-12') ? NodeDiv.className = 'col-md-6' : NodeDiv.className = 'col-md-12'">
                      <i class="float-right pull-right fa "
                        [ngClass]="{'fa-window-minimize': NodeDiv?.classList.contains('col-md-12'), 'fa-window-maximize': NodeDiv?.classList.contains('col-md-6')}"></i>
                    </button>
                  </div>
                  <div class="card-body" style="background-color: #faf9f8">
                    <div class="row form-group">
                      <div class="col-md-4">
                        <button type="submit" class="btn btn-primary btn-sm"
                          tooltip="Browse the BoK to annotate concepts."
                          (click)="reuseOrAnnotate='Annotate'; bokModal.show(); ">
                          Annotate with BoK concepts
                        </button>
                      </div>
                      <div class="col-md-8">
                        <ul>
                          <div *ngFor="let l of model.linksToBok; index as i ">
                            <li class="text-small">
                              <a href="https://gistbok-bok.ucgis.org/{{ l.concept_id }}" target="_blank">{{l.name }} </a>
                              <button type="button" class="btn btn-link btn-xs" tooltip="Click to remove"
                                (click)="removeBokKnowledge(model, i, 'linksToBok')">
                                <i class="fa fa-remove"></i>
                              </button>
                            </li>
                          </div>
                        </ul>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-10">
                        <div class="form-group">
                          <label for="title">Title</label>
                          <input type="text" class="form-control" id="title" placeholder="Title"
                            [(ngModel)]="model.name" name="title" required (keyup)="updateTreeStudyProgram()"
                            maxlength="100" />
                        </div>
                      </div>
                      <div class="col-md-2 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="reuseOrAnnotate='Re-use'; bokModal.show(); linkBoKto='name'">
                          Re-use BoK title
                        </button>
                      </div>

                      <div class="col-md-9">
                        <div class="form-group">
                          <label for="title">Affiliation</label>
                          <input type="text" class="form-control" id="affiliation"
                            placeholder="Fill in affiliation name" [(ngModel)]="model.affiliation" name="affiliation"
                            required (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                      <div class="col-md-3">
                        <div class="form-group">
                          <label for="eqf">EQF</label>
                          <span
                            tooltip="EQF concerns the level of what a learner knows, understands (knowledge) and is able to do (skills). It ranges from 1 (basic) to 8 (advanced)"
                            class="badge badge-primary badge-pill">i</span>
                          <a style="text-align: right" href="https://www.cedefop.europa.eu/en/events-and-projects/projects/european-qualifications-framework-eqf" target="_blank" >What is EQF?</a>
                          <input type="number" size="1" class="form-control" id="eqf" [(ngModel)]="model.eqf" name="eqf"
                            min="1" max="8" (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                      <div class="col-md-12">
                        <div class="form-group">
                          <!--     <label for="title">Affiliation webpage</label> -->
                          <input type="text" class="form-control" id="urlAff" placeholder="Fill in URL (to, e.g., official description, further information, ...)"
                            [(ngModel)]="model.urlAff" name="urlAff" (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>

                    </div>
                    <div class="row">
                      <div class="col-md-9">
                        <div class="form-group">
                          <label for="field">Study areas</label>
                          <span
                            tooltip="The term relates directly to a specific area of study. The International Standard Classification of Education: Fields of Education and Training 2013 (ISCED-F). Maintained by the UNESCO Institute for Statistics."
                            class="badge badge-primary badge-pill">i</span>
                          <a href="https://circabc.europa.eu/sd/a/286ebac6-aa7c-4ada-a42b-ff2cf3a442bf/ISCED-F 2013 - Detailed field descriptions.pdf" target="_blank">What is a Study area?</a>
                          <ng-select [items]="fieldsService.allfields" name="fields" bindLabel="name"
                            groupBy="grandparent" [multiple]="true" [(ngModel)]="model.fields">
                            <ng-template ng-optgroup-tmp let-item="item">
                              {{item.grandparent || 'Unnamed group'}}
                            </ng-template>
                          </ng-select>
                        </div>
                      </div>
                      <div class="col-md-3">
                        <div class="form-group">
                          <label for="numSemesters">Amount of semesters</label>
                          <span tooltip="Number of semesters in the educational offer."
                            class="badge badge-primary badge-pill">i</span>
                          <input type="text" size="10" class="form-control" id="numSemesters"
                            [(ngModel)]="model.numSemesters" name="numSemesters" min="1" max="20"
                            (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                    </div>
                    <div class="row" *ngIf="model.fields.length > 0">
                      <div class="col-md-12">
                        <label for="numSemesters">Study areas ({{model.fields.length}})</label>
                        <ul>
                          <div *ngFor="let f of model.fields; index as i ">
                            <li>
                              <p>{{f.name}} ({{f.grandparent}}) <button type="button" class="btn btn-link btn-xs"
                                  (click)="model.fields.splice(i, 1); updateFields()" tooltip="Click to remove">
                                  <i class="fa fa-remove"></i>
                                </button></p>
                            </li>
                          </div>
                        </ul>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label for="title">Associated training material</label>
                          <input type="text" class="form-control" id="urlTM" placeholder="Fill in the URL (to, e.g., learning platform, online syllabus, ...)"
                            [(ngModel)]="model.urlTM" name="urlTM" (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-9">
                        <div class="form-group">
                          <label for="description">Description</label>
                          <textarea class="form-control" id="description" name="description"
                            placeholder="Add a short introduction and other information relevant to the study program..."
                            [(ngModel)]="model.description" rows="4" (keyup)="updateTreeStudyProgram()"> </textarea>

                        </div>
                      </div>
                      <div class="col-md-3 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="reuseOrAnnotate='Re-use'; bokModal.show(); linkBoKto='description'">
                          Re-use BoK description
                        </button>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-9">
                        <hr>
                        <div class="form-group">
                          <label for="title">
                            <button type="button" class="btn btn-link btn-xs"
                              (click)="showStudyILO.classList.contains('hidden') ? showStudyILO.className = 'row' : showStudyILO.className = 'row hidden' ">
                              <i [tooltip]="showStudyILO.classList.contains('hidden')? 'Show' : 'Hide'"
                                [ngClass]="showStudyILO.classList.contains('hidden')? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                            </button>
                            Inherited Learning Outcomes ({{model.inheritedLearningObjectives.length}})</label>
                          <div class="row" #showStudyILO>
                            <div class="col-md-12">
                              <div *ngIf="model && model.inheritedLearningObjectives">
                                <ul>
                                  <div *ngFor="let p of model.inheritedLearningObjectives; index as i ">
                                    <li *ngIf="p.name == p.concept_id">{{p.name}}
                                    </li>
                                    <li *ngIf="p.name != p.concept_id">
                                      <a href="https://gistbok-bok.ucgis.org/{{p.concept_id}}" target="_blank">{{p.name}}</a>
                                    </li>
                                  </div>
                                </ul>
                              </div>
                              <div
                                *ngIf="!model.inheritedLearningObjectives || model.inheritedLearningObjectives.length == 0"
                                class="text-placeholder">
                                Add some courses and explore BoK to add some.
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-3 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm" disabled>
                          Inherited from children educational offer
                        </button>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-9">
                        <hr>
                        <div class="form-group">
                          <label for="title">
                            <button type="button" class="btn btn-link btn-xs"
                              (click)="showStudyLO.classList.contains('hidden') ? showStudyLO.className = 'row' : showStudyLO.className = 'row hidden' ">
                              <i [tooltip]="showStudyLO.classList.contains('hidden')? 'Show' : 'Hide'"
                                [ngClass]="showStudyLO.classList.contains('hidden')? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                            </button>
                            Learning Outcomes ({{model.learningObjectives.length}})</label>
                          <div class="row" #showStudyLO>
                            <div class="col-md-12">
                              <div *ngIf="model && model.learningObjectives">
                                <ul>
                                  <div *ngFor="let p of model.learningObjectives; index as i ">
                                    <li *ngIf="p.name == p.concept_id">{{p.name}} <button type="button" class="btn btn-link" tooltip="Click to remove"
                                        (click)="removeBokKnowledge(model, i, 'learningObjectives')">
                                        <i class="fa fa-remove"></i>
                                      </button></li>
                                    <li *ngIf="p.name != p.concept_id"> <a href="https://gistbok-bok.ucgis.org/{{p.concept_id}}"
                                                                           target="_blank">{{p.name}}</a>
                                      <button type="button" class="btn btn-link" tooltip="Click to remove"
                                              (click)="removeBokKnowledge(model, i, 'learningObjectives')">
                                        <i class="fa fa-remove"></i>
                                      </button></li>
                                  </div>
                                </ul>
                              </div>
                              <div *ngIf="!model.learningObjectives || model.learningObjectives.length == 0"
                                class="text-placeholder">
                                Explore the Body of Knowledge to add some or add custom learning outcomes.
                              </div>

                              <br>
                              <div class="row">
                                <div class="col-md-2"></div>
                                <div class="col-md-6">
                                  <input type="text" class="form-control" id="customLO" maxlength="150"
                                    placeholder="Add custom learning outcome" [(ngModel)]="customLO" name="customLO" />
                                </div>
                                <div class="col-md-4">
                                  <button type="button" class="btn btn-primary btn-sm" (click)="addCustomLO(model)"
                                    [disabled]="customLO.length < 1">
                                    Add custom LO
                                  </button>
                                </div>
                              </div>

                              <div style="text-align: center">
                                <a (click)="openModal(template)">Please see the guidelines to define skills</a>
                              </div>
                              <ng-template #template>
                                <div class="modal-primary ">
                                  <div class="modal-header">
                                    <h4 class="modal-title pull-left">Guidelines</h4>
                                    <button type="button" class="close pull-right" aria-label="Close"
                                      (click)="modalRef.hide()">
                                      <span aria-hidden="true">&times;</span>
                                    </button>
                                  </div>
                                  <div class="modal-body">
                                    <p style="text-align:justify;"> A learning outcome is a statement of what a learner
                                      knows, understands and is able to do on completion of a learning process (Source:
                                      European Commission)
                                      In the context of UCGIS, it is formulated as <strong> verb + (BoK) concept
                                        relevant statement </strong>, using active voice, by the use of verbs from the
                                      Bloom's revised taxonomy. <br>
                                      Some examples of learning outcomes associated to BoK concepts: </p>

                                    <p style="text-align:justify;"> <span>&#8226;</span> BoK ConceptÂ  - Learning outcome
                                      <br>
                                      <span>&#8226;</span> Spatial simulation modelling -Â Perform a simulation
                                      experiment using available simulation software <br>
                                      <span>&#8226;</span> Data model and format conversion - Convert a data set from
                                      the native format of one GIS product to another <br>
                                      <span>&#8226;</span> Vagueness -Â Evaluate vagueness in the locations, time,
                                      attributes, and other aspects of geographic phenomena </p>

                                    <table class="table">
                                      <thead>
                                        <tr>
                                          <th *ngFor="let tax of taxonomy"> {{tax.name}}</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        <ng-container *ngFor="let tax of taxonomy; index as a">
                                          <td>
                                            <tr *ngFor="let obj of tax.content; index as b">
                                              {{obj}}
                                            </tr>
                                          </td>
                                        </ng-container>
                                      </tbody>
                                    </table>
                                  </div>
                                </div>
                              </ng-template>

                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-3 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="reuseOrAnnotate='Re-use'; bokModal.show(); linkBoKto='learningObjectives'">
                          Re-use BoK learning outcomes
                        </button>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12">
                        <hr>
                        <label for="description">Transversal skills</label>
                      </div>
                      <div class="col-md-6">
                        <div class="input-group">
                          <ng-select *ngIf="isfullESCOcompetences" [items]="escoService.allcompetences"
                            name="competences" bindLabel="preferredLabel" groupBy="reuseLevel" [multiple]="true"
                            [searchFn]="customSearchFn" placeholder="Search..." [clearSearchOnAdd]="true"
                            [(ngModel)]="model.competences" [clearable]="false" (change)="updateTreeStudyProgram()">
                          </ng-select>
                          <ng-select *ngIf="!isfullESCOcompetences" [items]="competences" name="competences"
                            bindLabel="preferredLabel" groupBy="reuseLevel" [multiple]="true"
                            [searchFn]="customSearchFn" placeholder="Search..." [clearSearchOnAdd]="true"
                            [(ngModel)]="model.competences" [clearable]="false" (change)="updateTreeStudyProgram()">
                          </ng-select>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <span class="input-group-prepend">
                          <label class="switch switch-label switch-pill switch-outline-primary-alt">
                            <input class="switch-input" type="checkbox" value="isfullESCOcompetences"
                              [(ngModel)]="isfullESCOcompetences" checked />
                            <span class="switch-slider"
                              tooltip="Click here to add to the dropdown full list of ESCO skills." data-checked="âœ“"
                              data-unchecked="X"></span>
                          </label>
                          <div class="pl-1">Search full <a href="https://ec.europa.eu/esco/portal/skill"
                              target="_blank">ESCO</a>
                            skills
                          </div>
                        </span>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12">
                        <ul>
                          <div *ngFor="let mc of model.competences; index as i ">
                            <li *ngIf="!mc.uri">{{ mc.preferredLabel }}
                              <button type="button" class="btn btn-link" tooltip="Click to remove"
                                (click)="removeCompetence(mc, model.competences)">
                                <i class="fa fa-remove"></i>
                              </button></li>
                            <li *ngIf="mc.uri && mc.uri != ''"> <a href="{{mc.uri}}"
                                target="_blank">{{ mc.preferredLabel }} </a>
                              <button type="button" class="btn btn-link" tooltip="Click to remove"
                                (click)="removeCompetence(mc, model.competences)">
                                <i class="fa fa-remove"></i>
                              </button></li>
                          </div>
                        </ul>
                      </div>
                    </div>
                    <div class="row pt-1">
                      <div class="col-md-12">

                        This service uses the <a href="http://ec.europa.eu/esco" target="_blank"> ESCO </a>
                        classification of the
                        European Commission. <br> If you cannot find the specified transversal skill, you can also add
                        your own here:

                      </div>
                    </div>
                    <div class="row pt-1 form-group">
                      <div class="col-md-6">
                        <input #competenceExtra type="text" class="form-control" id="competenceExtra"
                          placeholder="Custom transversal skill" name="competenceExtra" maxlength="150"
                          (keyup)="competenceExtraAdd.disabled = false"
                          (keydown.enter)="addExtraCompetence(competenceExtra.value, model); competenceExtra.value= ''; competenceExtraAdd.disabled = true" />
                      </div>
                      <div class="col-md-6">
                        <button #competenceExtraAdd type="submit" class="btn btn-primary btn-sm"
                          tooltip="Add your custom transversal skill."
                          (click)="addExtraCompetence(competenceExtra.value, model); competenceExtra.value= ''; competenceExtraAdd.disabled = true"
                          disabled>
                          Add custom transversal skill
                        </button>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12">
                        <div *ngIf="model && model.children && model.children.length > 0">
                          <label for="children">
                            <button type="button" class="btn btn-link btn-xs"
                              (click)="sortableChildren.classList.contains('hidden') ? sortableChildren.className = '' : sortableChildren.className = 'hidden' ">
                              <i [tooltip]="sortableChildren.classList.contains('hidden')? 'Show' : 'Hide'"
                                [ngClass]="sortableChildren.classList.contains('hidden')? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                            </button>
                            Child educational offers ({{model.children.length}})
                            <span
                              tooltip="Select and drag item to reorder children. Or use arrows to move them up and down."
                              class="badge badge-primary badge-pill">i</span></label>
                          <div #sortableChildren>
                            <ngx-sortable [items]="model.children" [name]="''" (listSorted)="listSorted($event)"
                              *ngIf="model && model.children && model.children.length > 0">
                              <ng-template let-item>
                                <div class="sortable-list-item">
                                  {{item.data.name}}
                                </div>
                              </ng-template>
                            </ngx-sortable>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!--   </form> -->
              <!-- depth = 1 -> Modules -->
              <div *ngIf="!isSearchingExisting && currentTreeNode.data.depth == 1 && !isSearchingSpecific">
                <!-- <form #newOPForm="ngForm"> -->
                <div class="card card-accent-secondary">
                  <div class="card-header">
                    <div class="row text-center">
                      <div class="col-md-4">
                        Module Information
                        <span
                          tooltip="Fill in here your Module information. To link BoK concepts to your content click on the link BoK buttons."
                          class="badge badge-primary badge-pill">i</span>
                      </div>
                      <div class="col-md-4">
                        <button type="submit" class="btn btn-pill btn-primary btn-sm ml-2" (click)="saveCurrentNode()"
                          [hidden]="highestItemLevel==1" [ngClass]="{'success': isSavedBB}">
                          <i class="fa fa-save"></i> Promote
                        </button>
                        <span [hidden]="highestItemLevel==1"
                          tooltip="By promoting a unit (= the current node), it will be saved as an independent educational offer (= a copy), which will then show up in searches and can be re-used. Note than modifying the promoted node will not effect the original, and vice-versa."
                          class="badge badge-primary badge-pill">i</span>
                      </div>
                      <div class="col-md-4">
                        <button class="btn btn-link float-right pull-right"
                          (click)="NodeDiv.classList.contains('col-md-12') ? NodeDiv.className = 'col-md-6' : NodeDiv.className = 'col-md-12'">
                          <i class="float-right pull-right fa "
                            [ngClass]="{'fa-window-minimize': NodeDiv?.classList.contains('col-md-12'), 'fa-window-maximize': NodeDiv?.classList.contains('col-md-6')}"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="card-body" style="background-color: #faf9f8">
                    <p *ngIf="isSavedBB" class="success"> {{isSavedBBText}} <a
                        href="https://ucgis-tools-cdt.web.app/detail/{{promotedId}}" target="_blank">edit it here</a></p>
                    <div class="row form-group">
                      <div class="col-md-4">
                        <button type="submit" class="btn btn-primary btn-sm"
                          tooltip="Browse the BoK to annotate concepts."
                          (click)="reuseOrAnnotate='Annotate'; bokModal.show(); ">
                          Annotate with BoK concepts
                        </button>
                      </div>
                      <div class="col-md-8">
                        <ul>
                          <div *ngFor="let l of modelModule.linksToBok; index as i ">
                            <li class="text-small">
                              <a href="https://gistbok-bok.ucgis.org/{{ l.concept_id }}" target="_blank">{{l.name }} </a>
                              <button type="button" class="btn btn-link btn-xs" tooltip="Click to remove"
                                (click)="removeBokKnowledge(modelModule, i, 'linksToBok')">
                                <i class="fa fa-remove"></i>
                              </button>
                            </li>
                          </div>
                        </ul>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-10">
                        <div class="form-group">
                          <label for="title">Title</label>
                          <input type="text" class="form-control" id="title" placeholder="Title" maxlength="100"
                            [(ngModel)]="modelModule.name" name="title" required (keyup)="updateTreeStudyProgram()" />

                        </div>
                      </div>
                      <div class="col-md-2 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="reuseOrAnnotate='Re-use'; bokModal.show(); linkBoKto='name'">
                          Re-use BoK title
                        </button>
                      </div>
                    </div>
                    <div class="row" *ngIf="highestItemLevel == 1">
                      <div class="col-md-9">
                        <div class="form-group">
                          <label for="title">Affiliation</label>
                          <input type="text" class="form-control" id="affiliation"
                            placeholder="Fill in affiliation name" [(ngModel)]="modelModule.affiliation"
                            name="affiliation" required (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                      <div class="col-md-3">
                        <div class="form-group">
                          <label for="eqf">EQF</label>
                          <span
                            tooltip="EQF concerns the level of what a learner knows, understands (knowledge) and is able to do (skills). It ranges from 1 (basic) to 8 (advanced)"
                            class="badge badge-primary badge-pill">i</span>
                          <a style="text-align: right" href="https://www.cedefop.europa.eu/en/events-and-projects/projects/european-qualifications-framework-eqf" target="_blank" >What is EQF?</a>
                          <input type="number" size="1" class="form-control" id="eqf" [(ngModel)]="modelModule.eqf"
                            name="eqf" min="1" max="8" (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                      <div class="col-md-12">
                        <div class="form-group">
                          <!--                           <label for="title">Affiliation webpage</label>
 --> <input type="text" class="form-control" id="urlAff" placeholder="Fill in URL (to, e.g., official description, further information, ...)"
                            [(ngModel)]="modelModule.urlAff" name="urlAff" (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                      <div class="col-md-12">
                        <div class="form-group">
                          <label for="field">Study areas</label>
                          <span
                            tooltip="The term relates directly to a specific area of study. The International Standard Classification of Education: Fields of Education and Training 2013 (ISCED-F). Maintained by the UNESCO Institute for Statistics."
                            class="badge badge-primary badge-pill">i</span>
                          <a href="https://circabc.europa.eu/sd/a/286ebac6-aa7c-4ada-a42b-ff2cf3a442bf/ISCED-F 2013 - Detailed field descriptions.pdf" target="_blank">What is a Study area?</a>
                          <ng-select [items]="fieldsService.allfields" name="fields" bindLabel="name"
                            groupBy="grandparent" [multiple]="true" [(ngModel)]="modelModule.fields">
                            <ng-template ng-optgroup-tmp let-item="item">
                              {{item.grandparent || 'Unnamed group'}}
                            </ng-template>
                          </ng-select>
                        </div>
                      </div>
                      <div class="col-md-12" *ngIf="modelModule.fields.length > 0">
                        <label for="numSemesters">Selected study areas ({{modelModule.fields.length}})</label>
                        <ul>
                          <div *ngFor="let f of modelModule.fields; index as i ">
                            <li>
                              <p>{{f.name}} ({{f.grandparent}}) <button type="button" class="btn btn-link btn-xs"
                                  (click)="modelModule.fields.splice(i, 1); updateFields()" tooltip="Click to remove">
                                  <i class="fa fa-remove"></i>
                                </button></p>
                            </li>
                          </div>
                        </ul>
                      </div>

                      <div class="col-md-12">
                        <div class="form-group">
                          <label for="title">Associated training material</label>
                          <input type="text" class="form-control" id="urlTM" placeholder="Fill in the URL (to, e.g., learning platform, online syllabus, ...)"
                            [(ngModel)]="modelModule.urlTM" name="urlTM" (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="numSemester">Number of semester</label>
                          <span tooltip="In which semester is taught." class="badge badge-primary badge-pill">i</span>
                          <input type="text" size="10" class="form-control" id="numSemester"
                            [(ngModel)]="modelModule.numSemester" name="numSemester" min="1" max="15"
                            (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="ects">ECTS</label>
                          <span
                            tooltip="European Credit Transfer and Accumulation System (ECTS) is a standard means for comparing academic credits for higher education. One academic year corresponds to 60 ECTS credits that are normally equivalent to 1500â€“1800 hours of total workload."
                            class="badge badge-primary badge-pill">i</span>
                          <a style="text-align: right" href="https://ec.europa.eu/education/resources-and-tools/european-credit-transfer-and-accumulation-system-ects_en" target="_blank" >What is ECTS?</a>
                          <input type="number" class="form-control" id="ects" [(ngModel)]="modelModule.ects" name="ects"
                            min="0" (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-9">
                        <div class="form-group">
                          <label for="description">Description</label>
                          <textarea class="form-control" id="description" name="description"
                            [(ngModel)]="modelModule.description" rows="4"
                            placeholder="Add a short introduction and other information relevant to the module..."
                            (keyup)="updateTreeStudyProgram()"> </textarea>

                        </div>
                      </div>
                      <div class="col-md-3 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="reuseOrAnnotate='Re-use'; bokModal.show(); linkBoKto='description'">
                          Re-use BoK description
                        </button>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-9">
                        <hr>
                        <div class="form-group">
                          <label for="prerequisites">Prerequisites</label>
                          <div class="col-md-12">
                            <div *ngIf="modelModule && modelModule.prerequisites">
                              <ul>
                                <div *ngFor="let p of modelModule.prerequisites; index as i ">
                                  <li>{{p.name}} <button type="button" class="btn btn-link" tooltip="Click to remove"
                                      (click)="removeBokKnowledge(modelModule, i, 'prerequisites')">
                                      <i class="fa fa-remove"></i>
                                    </button></li>
                                </div>
                              </ul>
                            </div>
                            <div *ngIf="!modelModule.prerequisites || modelModule.prerequisites.length == 0"
                              class="text-placeholder">
                              Explore the Body of Knowledge to add some.
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-3 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="reuseOrAnnotate='Re-use'; bokModal.show(); linkBoKto='prerequisites'">
                          Re-use BoK prerequisite
                        </button>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-9">
                        <hr>
                        <div class="form-group">
                          <label for="title">
                            <button type="button" class="btn btn-link btn-xs"
                              (click)="showModuleILO.classList.contains('hidden') ? showModuleILO.className = 'row' : showModuleILO.className = 'row hidden' ">
                              <i [tooltip]="showModuleILO.classList.contains('hidden')? 'Show' : 'Hide'"
                                [ngClass]="showModuleILO.classList.contains('hidden')? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                            </button>
                            Inherited Learning Outcomes ({{modelModule.inheritedLearningObjectives.length}})</label>
                          <div class="row" #showModuleILO>
                            <div class="col-md-12">
                              <div *ngIf="modelModule && modelModule.inheritedLearningObjectives">
                                <ul>
                                  <div *ngFor="let p of modelModule.inheritedLearningObjectives; index as i ">
                                    <li *ngIf="p.name == p.concept_id">{{p.name}}
                                    </li>
                                    <li *ngIf="p.name != p.concept_id">
                                      <a href="https://gistbok-bok.ucgis.org/{{p.concept_id}}" target="_blank">{{p.name}}</a>
                                    </li>
                                  </div>
                                </ul>
                              </div>
                              <div
                                *ngIf="!modelModule.inheritedLearningObjectives || modelModule.inheritedLearningObjectives.length == 0"
                                class="text-placeholder">
                                Add some courses and explore BoK to add some.
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-3 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm" disabled>
                          Inherited from children educational offer
                        </button>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-9">
                        <hr>
                        <div class="form-group">
                          <label for="title">
                            <button type="button" class="btn btn-link btn-xs"
                              (click)="showModuleLO.classList.contains('hidden') ? showModuleLO.className = 'row' : showModuleLO.className = 'row hidden' ">
                              <i [tooltip]="showModuleLO.classList.contains('hidden')? 'Show' : 'Hide'"
                                [ngClass]="showModuleLO.classList.contains('hidden')? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                            </button>
                            Learning Outcomes ({{modelModule.learningObjectives.length}})</label>
                          <div class="row" #showModuleLO>
                            <div class="col-md-12">
                              <div *ngIf="modelModule && modelModule.learningObjectives">
                                <ul>
                                  <div *ngFor="let p of modelModule.learningObjectives; index as i ">
                                    <li *ngIf="p.name == p.concept_id">{{p.name}} <button type="button" class="btn btn-link" tooltip="Click to remove" (click)="removeBokKnowledge(modelModule, i, 'learningObjectives')">
                                      <i class="fa fa-remove"></i>
                                    </button></li>
                                    <li *ngIf="p.name != p.concept_id"> <a href="https://gistbok-bok.ucgis.org/{{p.concept_id}}" target="_blank">{{p.name}}</a>
                                      <button type="button" class="btn btn-link" tooltip="Click to remove"
                                              (click)="removeBokKnowledge(modelModule, i, 'learningObjectives')">
                                        <i class="fa fa-remove"></i>
                                      </button></li>
                                  </div>
                                </ul>
                              </div>
                              <div *ngIf="!modelModule.learningObjectives || modelModule.learningObjectives.length == 0"
                                class="text-placeholder">
                                Explore the Body of Knowledge to add some or add custom learning outcomes.
                              </div>

                              <br>
                              <div class="row">
                                <div class="col-md-2"></div>
                                <div class="col-md-6">
                                  <input type="text" class="form-control" id="customLO" maxlength="150"
                                    placeholder="Add custom learning outcome" [(ngModel)]="customLO" name="customLO" />
                                </div>
                                <div class="col-md-4">
                                  <button type="button" class="btn btn-primary btn-sm" [disabled]="customLO.length < 1"
                                    (click)="addCustomLO(modelModule)">
                                    Add custom LO
                                  </button>
                                </div>
                              </div>
                              <div style="text-align: center">
                                <a (click)="openModal(template)">Please see the guidelines to define skills</a>
                              </div>
                              <ng-template #template>
                                <div class="modal-primary ">
                                  <div class="modal-header">
                                    <h4 class="modal-title pull-left">Guidelines</h4>
                                    <button type="button" class="close pull-right" aria-label="Close"
                                      (click)="modalRef.hide()">
                                      <span aria-hidden="true">&times;</span>
                                    </button>
                                  </div>
                                  <div class="modal-body">
                                    <p style="text-align:justify;"> A learning outcome is a statement of what a learner
                                      knows, understands and is able to do on completion of a learning process (Source:
                                      European Commission)
                                      In the context of UCGIS, it is formulated as <strong> verb + (BoK) concept
                                        relevant statement </strong>, using active voice, by the use of verbs from the
                                      Bloom's revised taxonomy. <br>
                                      Some examples of learning outcomes associated to BoK concepts: </p>

                                    <p style="text-align:justify;"> <span>&#8226;</span> BoK ConceptÂ  - Learning outcome
                                      <br>
                                      <span>&#8226;</span> Spatial simulation modelling -Â Perform a simulation
                                      experiment using available simulation software <br>
                                      <span>&#8226;</span> Data model and format conversion - Convert a data set from
                                      the native format of one GIS product to another <br>
                                      <span>&#8226;</span> Vagueness -Â Evaluate vagueness in the locations, time,
                                      attributes, and other aspects of geographic phenomena </p>

                                    <table class="table">
                                      <thead>
                                        <tr>
                                          <th *ngFor="let tax of taxonomy"> {{tax.name}}</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        <ng-container *ngFor="let tax of taxonomy; index as a">
                                          <td>
                                            <tr *ngFor="let obj of tax.content; index as b">
                                              {{obj}}
                                            </tr>
                                          </td>
                                        </ng-container>
                                      </tbody>
                                    </table>
                                  </div>
                                </div>
                              </ng-template>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-3 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="reuseOrAnnotate='Re-use'; bokModal.show(); linkBoKto='learningObjectives'">
                          Re-use BoK learning outcomes
                        </button>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12">
                        <hr>
                        <label for="description">Transversal skills</label>
                      </div>
                      <div class="col-md-6">
                        <div class="input-group">
                          <ng-select *ngIf="isfullESCOcompetences" [items]="escoService.allcompetences"
                            name="competences" bindLabel="preferredLabel" groupBy="reuseLevel" [multiple]="true"
                            [searchFn]="customSearchFn" placeholder="Search..." [clearSearchOnAdd]="true"
                            [(ngModel)]="modelModule.competences" [clearable]="false"
                            (change)="updateTreeStudyProgram()">
                            <ng-template ng-optgroup-tmp let-item="item">
                              {{item.reuseLevel || 'Unnamed group'}}
                            </ng-template>
                          </ng-select>
                          <ng-select *ngIf="!isfullESCOcompetences" [items]="competences" name="competences"
                            bindLabel="preferredLabel" groupBy="reuseLevel" [multiple]="true"
                            [searchFn]="customSearchFn" placeholder="Search..." [clearSearchOnAdd]="true"
                            [(ngModel)]="modelModule.competences" [clearable]="false"
                            (change)="updateTreeStudyProgram()">
                            <ng-template ng-optgroup-tmp let-item="item">
                              {{item.reuseLevel || 'Unnamed group'}}
                            </ng-template>
                          </ng-select>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <span class="input-group-prepend">
                          <label class="switch switch-label switch-pill switch-outline-primary-alt">
                            <input class="switch-input" type="checkbox" value="isfullESCOcompetences"
                              [(ngModel)]="isfullESCOcompetences" checked />
                            <span class="switch-slider"
                              tooltip="Click here to add to the dropdown full list of ESCO skills." data-checked="âœ“"
                              data-unchecked="X"></span>
                          </label>
                          <div class="pl-1">Search full <a href="https://ec.europa.eu/esco/portal/skill"
                              target="_blank">ESCO</a>
                            skills
                          </div>
                        </span>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12">
                        <ul>
                          <div *ngFor="let mc of modelModule.competences; index as i ">
                            <li *ngIf="!mc.uri">{{ mc.preferredLabel }}
                              <button type="button" class="btn btn-link" tooltip="Click to remove"
                                (click)="removeCompetence(mc, modelModule.competences)">
                                <i class="fa fa-remove"></i>
                              </button></li>
                            <li *ngIf="mc.uri && mc.uri != ''"> <a href="{{mc.uri}}"
                                target="_blank">{{ mc.preferredLabel }} </a>
                              <button type="button" class="btn btn-link" tooltip="Click to remove"
                                (click)="removeCompetence(mc, modelModule.competences)">
                                <i class="fa fa-remove"></i>
                              </button></li>
                          </div>
                        </ul>
                      </div>
                    </div>
                    <div class="row pt-1">
                      <div class="col-md-12">

                        This service uses the <a href="http://ec.europa.eu/esco" target="_blank"> ESCO </a>
                        classification of the
                        European Commission. <br> If you cannot find the specified transversal skill, you can also add
                        your own here:

                      </div>
                    </div>
                    <div class="row pt-1 form-group">
                      <div class="col-md-6">
                        <input #competenceExtra type="text" class="form-control" id="competenceExtra"
                          placeholder="Custom transversal skill" name="competenceExtra"
                          (keyup)="competenceExtraAdd.disabled = false" maxlength="150"
                          (keydown.enter)="addExtraCompetence(competenceExtra.value, modelModule); competenceExtra.value= ''; competenceExtraAdd.disabled = true" />
                      </div>
                      <div class="col-md-6">
                        <button #competenceExtraAdd type="submit" class="btn btn-primary btn-sm"
                          tooltip="Add your custom transversal skill."
                          (click)="addExtraCompetence(competenceExtra.value, modelModule); competenceExtra.value= ''; competenceExtraAdd.disabled = true"
                          disabled>
                          Add custom transversal skill
                        </button>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12">
                        <div *ngIf="modelModule && modelModule.children && modelModule.children.length > 0">
                          <label for="children">
                            <button type="button" class="btn btn-link btn-xs"
                              (click)="sortableChildren.classList.contains('hidden') ? sortableChildren.className = '' : sortableChildren.className = 'hidden' ">
                              <i [tooltip]="sortableChildren.classList.contains('hidden')? 'Show' : 'Hide'"
                                [ngClass]="sortableChildren.classList.contains('hidden')? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                            </button>
                            Child educational offer ({{modelModule.children.length}})
                            <span
                              tooltip="Select and drag item to reorder children. Or use arrows to move them up and down."
                              class="badge badge-primary badge-pill">i</span></label>
                          <div #sortableChildren>
                            <ngx-sortable [items]="modelModule.children" [name]="''" (listSorted)="listSorted($event)"
                              *ngIf="modelModule && modelModule.children && modelModule.children.length > 0">
                              <ng-template let-item>
                                <div class="sortable-list-item">
                                  {{item.data.name}}
                                </div>
                              </ng-template>
                            </ngx-sortable>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!--   </form> -->
              </div>
              <!-- depth = 2 -> Course -->
              <div *ngIf="!isSearchingExisting && currentTreeNode.data.depth == 2 && !isSearchingSpecific">
                <!-- <form #newOPForm="ngForm"> -->
                <div class="card card-accent-secondary">
                  <div class="card-header">
                    <div class="row text-center">
                      <div class="col-md-4">
                        Course Information
                        <span
                          tooltip="Fill in here your Course information. To link BoK concepts to your content click on the link BoK buttons."
                          class="badge badge-primary badge-pill">i</span>
                      </div>
                      <div class="col-md-4">
                        <button type="submit" class="btn btn-pill btn-primary btn-sm ml-2" (click)="saveCurrentNode()"
                          [hidden]="highestItemLevel==2" [ngClass]="{'success': isSavedBB}">
                          <i class="fa fa-save"></i> Promote
                        </button>
                        <span [hidden]="highestItemLevel==2"
                          tooltip="By promoting a unit (= the current node), it will be saved as an independent educational offer (= a copy), which will then show up in searches and can be re-used. Note than modifying the promoted node will not effect the original, and vice-versa."
                          class="badge badge-primary badge-pill">i</span>
                      </div>
                      <div class="col-md-4">
                        <button class="btn btn-link float-right pull-right"
                          (click)="NodeDiv.classList.contains('col-md-12') ? NodeDiv.className = 'col-md-6' : NodeDiv.className = 'col-md-12'">
                          <i class="float-right pull-right fa "
                            [ngClass]="{'fa-window-minimize': NodeDiv?.classList.contains('col-md-12'), 'fa-window-maximize': NodeDiv?.classList.contains('col-md-6')}"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="card-body" style="background-color: #faf9f8">
                    <p *ngIf="isSavedBB" class="success"> {{isSavedBBText}} <a
                        href="https://ucgis-tools-cdt.web.app/detail/{{promotedId}}" target="_blank">edit it here</a></p>
                    <div class="row form-group">
                      <div class="col-md-4">
                        <button type="submit" class="btn btn-primary btn-sm"
                          tooltip="Browse the BoK to annotate concepts."
                          (click)="reuseOrAnnotate='Annotate'; bokModal.show(); ">
                          Annotate with BoK concepts
                        </button>
                      </div>
                      <div class="col-md-8">
                        <ul>
                          <div *ngFor="let l of modelCourse.linksToBok; index as i ">
                            <li class="text-small">
                              <a href="https://gistbok-bok.ucgis.org/{{ l.concept_id }}" target="_blank">{{l.name }} </a>
                              <button type="button" class="btn btn-link btn-xs" tooltip="Click to remove"
                                (click)="removeBokKnowledge(modelCourse, i, 'linksToBok')">
                                <i class="fa fa-remove"></i>
                              </button>
                            </li>
                          </div>
                        </ul>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-10">
                        <div class="form-group">
                          <label for="title">Title</label>
                          <input type="text" class="form-control" id="title" placeholder="Title" maxlength="100"
                            [(ngModel)]="modelCourse.name" name="title" required (keyup)="updateTreeStudyProgram()" />

                        </div>
                      </div>
                      <div class="col-md-2 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="reuseOrAnnotate='Re-use'; bokModal.show(); linkBoKto='name'">
                          Re-use BoK title
                        </button>
                      </div>
                    </div>
                    <div class="row" *ngIf="highestItemLevel == 2">
                      <div class="col-md-9">
                        <div class="form-group">
                          <label for="title">Affiliation</label>
                          <input type="text" class="form-control" id="affiliation"
                            placeholder="Fill in affiliation name" [(ngModel)]="modelCourse.affiliation"
                            name="affiliation" required (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                      <div class="col-md-3">
                        <div class="form-group">
                          <label for="eqf">EQF</label>
                          <span
                            tooltip="EQF concerns the level of what a learner knows, understands (knowledge) and is able to do (skills). It ranges from 1 (basic) to 8 (advanced)"
                            class="badge badge-primary badge-pill">i</span>
                          <input type="number" size="1" class="form-control" id="eqf" [(ngModel)]="modelCourse.eqf"
                            name="eqf" min="1" max="8" (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                      <div class="col-md-12">
                        <div class="form-group">
                          <!--   <label for="title">Affiliation webpage</label> -->
                          <input type="text" class="form-control" id="urlAff" placeholder="Fill in URL (to, e.g., official description, further information, ...)"
                            [(ngModel)]="modelCourse.urlAff" name="urlAff" (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                      <div class="col-md-12">
                        <div class="form-group">
                          <label for="field">Study areas </label>
                          <span
                            tooltip="The term relates directly to a specific area of study. The International Standard Classification of Education: Fields of Education and Training 2013 (ISCED-F). Maintained by the UNESCO Institute for Statistics."
                            class="badge badge-primary badge-pill">i</span>
                          <a href="https://circabc.europa.eu/sd/a/286ebac6-aa7c-4ada-a42b-ff2cf3a442bf/ISCED-F 2013 - Detailed field descriptions.pdf" target="_blank">What is a Study area?</a>
                          <ng-select [items]="fieldsService.allfields" name="fields" bindLabel="name"
                            groupBy="grandparent" [multiple]="true" [(ngModel)]="modelCourse.fields">
                            <ng-template ng-optgroup-tmp let-item="item">
                              {{item.grandparent || 'Unnamed group'}}
                            </ng-template>
                          </ng-select>
                        </div>
                      </div>
                      <div class="col-md-12" *ngIf="modelCourse.fields.length > 0">
                        <label for="numSemesters">Selected study areas ({{modelCourse.fields.length}})</label>
                        <ul>
                          <div *ngFor="let f of modelCourse.fields; index as i ">
                            <li>
                              <p>{{f.name}} ({{f.grandparent}}) <button type="button" class="btn btn-link btn-xs"
                                  (click)="modelCourse.fields.splice(i, 1); updateFields()" tooltip="Click to remove">
                                  <i class="fa fa-remove"></i>
                                </button></p>
                            </li>
                          </div>
                        </ul>
                      </div>

                      <div class="col-md-12">
                        <div class="form-group">
                          <label for="title">Associated training material</label>
                          <input type="text" class="form-control" id="urlTM" placeholder="Fill in the URL (to, e.g., learning platform, online syllabus, ...)"
                            [(ngModel)]="modelCourse.urlTM" name="urlTM" (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label for="eqf">Type</label>
                          <span tooltip="Specify course type if needed." class="badge badge-primary badge-pill">i</span>
                          <select [(ngModel)]="modelCourse.type" (change)="isSaved = false">
                            <option value=""></option>
                            <option value="Common">Common</option>
                            <option value="Specialization">Specialization</option>
                            <option value="Elective">Elective</option>
                          </select>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-9">
                        <div class="form-group">
                          <label for="description">Description</label>
                          <textarea class="form-control" id="description" placeholder="Description" name="description"
                            [(ngModel)]="modelCourse.description" (keyup)="updateTreeStudyProgram()" rows="4"
                            placeholder="Add a short introduction and other information relevant to the course..."></textarea>

                        </div>
                      </div>
                      <div class="col-md-3 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="reuseOrAnnotate='Re-use'; bokModal.show(); linkBoKto='description'">
                          Re-use BoK description
                        </button>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-9">
                        <hr>
                        <div class="form-group">
                          <label for="title">Prerequisites</label>
                          <div class="row">
                            <div class="col-md-12">
                              <div *ngIf="modelCourse && modelCourse.prerequisites">
                                <ul>
                                  <div *ngFor="let p of modelCourse.prerequisites; index as i ">
                                    <li>{{p.name}} <button type="button" class="btn btn-link" tooltip="Click to remove"
                                        (click)="removeBokKnowledge(modelCourse, i, 'prerequisites')">
                                        <i class="fa fa-remove"></i>
                                      </button></li>
                                  </div>
                                </ul>
                              </div>
                              <div *ngIf="!modelCourse.prerequisites || modelCourse.prerequisites.length == 0"
                                class="text-placeholder">
                                Explore the Body of Knowledge to add some.
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-3 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="reuseOrAnnotate='Re-use'; bokModal.show(); linkBoKto='prerequisites'">
                          Re-use BoK prerequisite
                        </button>
                      </div>

                    </div>
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="ects">ECTS</label>
                          <span
                            tooltip="European Credit Transfer and Accumulation System (ECTS) is a standard means for comparing academic credits for higher education. One academic year corresponds to 60 ECTS credits that are normally equivalent to 1500â€“1800 hours of total workload."
                            class="badge badge-primary badge-pill">i</span>
                          <a style="text-align: right" href="https://ec.europa.eu/education/resources-and-tools/european-credit-transfer-and-accumulation-system-ects_en" target="_blank" >What is ECTS?</a>
                          <input type="number" class="form-control" name="ects" id="ects" [(ngModel)]="modelCourse.ects"
                            name="ects" min="0" (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="numSemester">Number of semester</label>
                          <span tooltip="In which semester is taught." class="badge badge-primary badge-pill">i</span>
                          <input type="text" size="10" class="form-control" id="numSemester"
                            [(ngModel)]="modelCourse.numSemester" name="numSemester" min="1" max="999"
                            (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label for="assessment">Assessment</label>
                          <span tooltip="Describe how the course will be assessed."
                            class="badge badge-primary badge-pill">i</span>
                          <input type="text" class="form-control" id="assessment" placeholder="Assessment"
                            [(ngModel)]="modelCourse.assessment" name="assessment" (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-9">
                        <hr>
                        <div class="form-group">
                          <label for="title">
                            <button type="button" class="btn btn-link btn-xs"
                              (click)="showCourseILO.classList.contains('hidden') ? showCourseILO.className = 'row' : showCourseILO.className = 'row hidden' ">
                              <i [tooltip]="showCourseILO.classList.contains('hidden')? 'Show' : 'Hide'"
                                [ngClass]="showCourseILO.classList.contains('hidden')? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                            </button>
                            Inherited Learning Outcomes ({{modelCourse.inheritedLearningObjectives.length}})</label>
                          <div class="row" #showCourseILO>
                            <div class="col-md-12">
                              <div *ngIf="modelCourse && modelCourse.inheritedLearningObjectives">
                                <ul>
                                  <div *ngFor="let p of modelCourse.inheritedLearningObjectives; index as i ">
                                    <li *ngIf="p.name == p.concept_id">{{p.name}}
                                    </li>
                                    <li *ngIf="p.name != p.concept_id">
                                      <a href="https://gistbok-bok.ucgis.org/{{p.concept_id}}" target="_blank">{{p.name}}</a>
                                    </li>
                                  </div>
                                </ul>
                              </div>
                              <div
                                *ngIf="!modelCourse.inheritedLearningObjectives || modelCourse.inheritedLearningObjectives.length == 0"
                                class="text-placeholder">
                                Add some courses and explore BoK to add some.
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-3 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm" disabled>
                          Inherited from children educational offers
                        </button>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-9">
                        <hr>
                        <div class="form-group">
                          <label for="title">
                            <button type="button" class="btn btn-link btn-xs"
                              (click)="showCourseLO.classList.contains('hidden') ? showCourseLO.className = 'row' : showCourseLO.className = 'row hidden' ">
                              <i [tooltip]="showCourseLO.classList.contains('hidden')? 'Show' : 'Hide'"
                                [ngClass]="showCourseLO.classList.contains('hidden')? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                            </button>
                            Learning Outcomes ({{modelCourse.learningObjectives.length}})</label>
                          <div class="row" #showCourseLO>
                            <div class="col-md-12">
                              <div *ngIf="modelCourse && modelCourse.learningObjectives">
                                <ul>
                                  <div *ngFor="let p of modelCourse.learningObjectives; index as i ">
                                    <li *ngIf="p.name == p.concept_id">{{p.name}} <button type="button" class="btn btn-link" tooltip="Click to remove"
                                                                                                       (click)="removeBokKnowledge(modelCourse, i, 'learningObjectives')">
                                      <i class="fa fa-remove"></i>
                                    </button></li>
                                    <li *ngIf="p.name != p.concept_id"> <a href="https://gistbok-bok.ucgis.org/{{p.concept_id}}"
                                                                                                                             target="_blank">{{p.name}}</a>
                                      <button type="button" class="btn btn-link" tooltip="Click to remove"
                                              (click)="removeBokKnowledge(modelCourse, i, 'learningObjectives')">
                                        <i class="fa fa-remove"></i>
                                      </button></li>
                                  </div>
                                </ul>
                              </div>
                              <div *ngIf="!modelCourse.learningObjectives || modelCourse.learningObjectives.length == 0"
                                class="text-placeholder">
                                Explore the Body of Knowledge to add some or add custom learning outcomes.
                              </div>

                              <br>
                              <div class="row">
                                <div class="col-md-2"></div>
                                <div class="col-md-6">
                                  <input type="text" class="form-control" id="customLO" maxlength="150"
                                    placeholder="Add custom learning outcome" [(ngModel)]="customLO" name="customLO" />
                                </div>
                                <div class="col-md-4">
                                  <button type="button" class="btn btn-primary btn-sm" [disabled]="customLO.length < 1"
                                    (click)="addCustomLO(modelCourse)">
                                    Add custom LO
                                  </button>
                                </div>
                              </div>
                              <div style="text-align: center">
                                <a (click)="openModal(template)">Please see the guidelines to define skills</a>
                              </div>
                              <ng-template #template>
                                <div class="modal-primary ">
                                  <div class="modal-header">
                                    <h4 class="modal-title pull-left">Guidelines</h4>
                                    <button type="button" class="close pull-right" aria-label="Close"
                                      (click)="modalRef.hide()">
                                      <span aria-hidden="true">&times;</span>
                                    </button>
                                  </div>
                                  <div class="modal-body">
                                    <p style="text-align:justify;"> A learning outcome is a statement of what a learner
                                      knows, understands and is able to do on completion of a learning process (Source:
                                      European Commission)
                                      In the context of UCGIS, it is formulated as <strong> verb + (BoK) concept
                                        relevant statement </strong>, using active voice, by the use of verbs from the
                                      Bloom's revised taxonomy. <br>
                                      Some examples of learning outcomes associated to BoK concepts: </p>

                                    <p style="text-align:justify;"> <span>&#8226;</span> BoK ConceptÂ  - Learning outcome
                                      <br>
                                      <span>&#8226;</span> Spatial simulation modelling -Â Perform a simulation
                                      experiment using available simulation software <br>
                                      <span>&#8226;</span> Data model and format conversion - Convert a data set from
                                      the native format of one GIS product to another <br>
                                      <span>&#8226;</span> Vagueness -Â Evaluate vagueness in the locations, time,
                                      attributes, and other aspects of geographic phenomena </p>

                                    <table class="table">
                                      <thead>
                                        <tr>
                                          <th *ngFor="let tax of taxonomy"> {{tax.name}}</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        <ng-container *ngFor="let tax of taxonomy; index as a">
                                          <td>
                                            <tr *ngFor="let obj of tax.content; index as b">
                                              {{obj}}
                                            </tr>
                                          </td>
                                        </ng-container>
                                      </tbody>
                                    </table>
                                  </div>
                                </div>
                              </ng-template>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-3 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="reuseOrAnnotate='Re-use'; bokModal.show(); linkBoKto='learningObjectives'">
                          Re-use BoK learning outcomes
                        </button>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12">
                        <hr>
                        <label for="description">Transversal skills</label>
                      </div>
                      <div class="col-md-6">
                        <div class="input-group">
                          <ng-select *ngIf="isfullESCOcompetences" [items]="escoService.allcompetences"
                            name="competences" bindLabel="preferredLabel" groupBy="reuseLevel" [multiple]="true"
                            [searchFn]="customSearchFn" placeholder="Search..." [clearSearchOnAdd]="true"
                            [(ngModel)]="modelCourse.competences" [clearable]="false"
                            (change)="updateTreeStudyProgram()">
                            <ng-template ng-optgroup-tmp let-item="item">
                              {{item.reuseLevel || 'Unnamed group'}}
                            </ng-template>
                          </ng-select>
                          <ng-select *ngIf="!isfullESCOcompetences" [items]="competences" name="competences"
                            bindLabel="preferredLabel" groupBy="reuseLevel" [multiple]="true"
                            [searchFn]="customSearchFn" placeholder="Search..." [clearSearchOnAdd]="true"
                            [(ngModel)]="modelCourse.competences" [clearable]="false"
                            (change)="updateTreeStudyProgram()">
                            <ng-template ng-optgroup-tmp let-item="item">
                              {{item.reuseLevel || 'Unnamed group'}}
                            </ng-template>
                          </ng-select>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <span class="input-group-prepend">
                          <label class="switch switch-label switch-pill switch-outline-primary-alt">
                            <input class="switch-input" type="checkbox" value="isfullESCOcompetences"
                              [(ngModel)]="isfullESCOcompetences" checked />
                            <span class="switch-slider"
                              tooltip="Click here to add to the dropdown full list of ESCO skills." data-checked="âœ“"
                              data-unchecked="X"></span>
                          </label>
                          <div class="pl-1">Search full <a href="https://ec.europa.eu/esco/portal/skill"
                              target="_blank">ESCO</a>
                            skills
                          </div>
                        </span>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12">
                        <ul>
                          <div *ngFor="let mc of modelCourse.competences; index as i ">
                            <li *ngIf="!mc.uri">{{ mc.preferredLabel }}
                              <button type="button" class="btn btn-link" tooltip="Click to remove"
                                (click)="removeCompetence(mc, modelCourse.competences)">
                                <i class="fa fa-remove"></i>
                              </button></li>
                            <li *ngIf="mc.uri && mc.uri != ''"> <a href="{{mc.uri}}"
                                target="_blank">{{ mc.preferredLabel }} </a>
                              <button type="button" class="btn btn-link" tooltip="Click to remove"
                                (click)="removeCompetence(mc, modelCourse.competences)">
                                <i class="fa fa-remove"></i>
                              </button></li>
                          </div>
                        </ul>
                      </div>
                    </div>
                    <div class="row pt-1">
                      <div class="col-md-12">

                        This service uses the <a href="http://ec.europa.eu/esco" target="_blank"> ESCO </a>
                        classification of the
                        European Commission. <br> If you cannot find the specified transversal skill, you can also add
                        your own here:

                      </div>
                    </div>
                    <div class="row pt-1 form-group">
                      <div class="col-md-6">
                        <input #competenceExtra type="text" class="form-control" id="competenceExtra"
                          placeholder="Custom transversal skill" name="competenceExtra"
                          (keyup)="competenceExtraAdd.disabled = false" maxlength="150"
                          (keydown.enter)="addExtraCompetence(competenceExtra.value, modelCourse); competenceExtra.value= ''; competenceExtraAdd.disabled = true" />
                      </div>
                      <div class="col-md-6">
                        <button #competenceExtraAdd type="submit" class="btn btn-primary btn-sm"
                          tooltip="Add your custom transversal skill."
                          (click)="addExtraCompetence(competenceExtra.value, modelCourse); competenceExtra.value= ''; competenceExtraAdd.disabled = true"
                          disabled>
                          Add custom transversal skill
                        </button>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-9">
                        <hr>
                        <div class="form-group">
                          <label for="bibliography">Bibliography</label>
                          <span
                            tooltip="APA style. Example: Walford, N. (2002). Geographical data: Characteristics and sources. Chilchester: Wiley. ISBN: 9780471970859. DOI: https://doi.org/10.1046/j.0031-868X.2003.024_03.x"
                            class="badge badge-primary badge-pill">i</span>
                          <div class="row">
                            <div class="col-md-12">
                              <div *ngIf="modelCourse && modelCourse.bibliography">
                                <ul>
                                  <div *ngFor="let b of modelCourse.bibliography; index as i ">
                                    <li>{{b.name}} <button type="button" class="btn btn-link" tooltip="Click to remove"
                                        (click)="removeBokKnowledge(modelCourse, i, 'bibliography')">
                                        <i class="fa fa-remove"></i>
                                      </button></li>
                                  </div>
                                </ul>
                              </div>
                              <div *ngIf="!modelCourse.bibliography || modelCourse.bibliography.length == 0"
                                class="text-placeholder">
                                Explore the Body of Knowledge to add some bibliography or add your own.
                              </div>

                            </div>
                            <div class="col-md-8">
                              <input type="text" class="form-control" id="bibliography" placeholder="Bibliography"
                                maxlength="150" [(ngModel)]="customBib" name="bibliography" />
                            </div>
                            <div class="col-md-4">
                              <button type="button" class="btn btn-primary btn-sm" (click)="addCustomBib(modelCourse)">
                                Add custom Bibliography
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-3 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="reuseOrAnnotate='Re-use'; bokModal.show(); linkBoKto='bibliography'">
                          Re-use BoK bibliography
                        </button>
                      </div>

                    </div>
                    <div class="row">
                      <div class="col-md-12">
                        <div *ngIf="modelCourse && modelCourse.children && modelCourse.children.length > 0">
                          <label for="children">
                            <button type="button" class="btn btn-link btn-xs"
                              (click)="sortableChildren.classList.contains('hidden') ? sortableChildren.className = '' : sortableChildren.className = 'hidden' ">
                              <i [tooltip]="sortableChildren.classList.contains('hidden')? 'Show' : 'Hide'"
                                [ngClass]="sortableChildren.classList.contains('hidden')? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                            </button>
                            Child educational offers ({{modelCourse.children.length}})
                            <span
                              tooltip="Select and drag item to reorder children. Or use arrows to move them up and down."
                              class="badge badge-primary badge-pill">i</span></label>
                          <div #sortableChildren>
                            <ngx-sortable [items]="modelCourse.children" [name]="''" (listSorted)="listSorted($event)"
                              *ngIf="modelCourse && modelCourse.children && modelCourse.children.length > 0">
                              <ng-template let-item>
                                <div class="sortable-list-item">
                                  {{item.data.name}}
                                </div>
                              </ng-template>
                            </ngx-sortable>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!--   </form> -->

              <!-- depth = 3 -> Lectures -->
              <div *ngIf="!isSearchingExisting && currentTreeNode.data.depth == 3 && !isSearchingSpecific">
                <!-- <form #newOPForm="ngForm"> -->
                <div class="card card-accent-secondary">
                  <div class="card-header">
                    <div class="row text-center">
                      <div class="col-md-4">
                        Lecture Information
                        <span
                          tooltip="Fill in here your Lecture information. To link BoK concepts to your content click on the link BoK buttons."
                          class="badge badge-primary badge-pill">i</span>
                      </div>
                      <div class="col-md-4">
                        <button type="submit" class="btn btn-pill btn-primary btn-sm ml-2" (click)="saveCurrentNode()"
                          [hidden]="highestItemLevel==3" [ngClass]="{'success': isSavedBB}">
                          <i class="fa fa-save"></i> Promote
                        </button>
                        <span [hidden]="highestItemLevel==3"
                          tooltip="By promoting a unit (= the current node), it will be saved as an independent educational offer (= a copy), which will then show up in searches and can be re-used. Note than modifying the promoted node will not effect the original, and vice-versa."
                          class="badge badge-primary badge-pill">i</span>
                      </div>
                      <div class="col-md-4">
                        <button class="btn btn-link float-right pull-right"
                          (click)="NodeDiv.classList.contains('col-md-12') ? NodeDiv.className = 'col-md-6' : NodeDiv.className = 'col-md-12'">
                          <i class="float-right pull-right fa "
                            [ngClass]="{'fa-window-minimize': NodeDiv?.classList.contains('col-md-12'), 'fa-window-maximize': NodeDiv?.classList.contains('col-md-6')}"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="card-body" style="background-color: #faf9f8">
                    <p *ngIf="isSavedBB" class="success"> {{isSavedBBText}} <a
                        href="https://ucgis-tools-cdt.web.app/detail/{{promotedId}}" target="_blank">edit it here</a></p>
                    <div class="row form-group">
                      <div class="col-md-4">
                        <button type="submit" class="btn btn-primary btn-sm"
                          tooltip="Browse the BoK to annotate concepts."
                          (click)="reuseOrAnnotate='Annotate'; bokModal.show(); ">
                          Annotate with BoK concepts
                        </button>
                      </div>
                      <div class="col-md-8">
                        <ul>
                          <div *ngFor="let l of modelLecture.linksToBok; index as i ">
                            <li class="text-small">
                              <a href="https://gistbok-bok.ucgis.org/{{ l.concept_id }}" target="_blank">{{l.name }} </a>
                              <button type="button" class="btn btn-link btn-xs" tooltip="Click to remove"
                                (click)="removeBokKnowledge(modelLecture, i, 'linksToBok')">
                                <i class="fa fa-remove"></i>
                              </button>
                            </li>
                          </div>
                        </ul>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-10">
                        <div class="form-group">
                          <label for="title">Title</label>
                          <input type="text" class="form-control" id="title" placeholder="Title" maxlength="100"
                            [(ngModel)]="modelLecture.name" name="title" required (keyup)="updateTreeStudyProgram()" />

                        </div>
                      </div>
                      <div class="col-md-2 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="reuseOrAnnotate='Re-use'; bokModal.show(); linkBoKto='name'">
                          Re-use BoK title
                        </button>
                      </div>
                    </div>
                    <div class="row" *ngIf="highestItemLevel == 3">
                      <div class="col-md-9">
                        <div class="form-group">
                          <label for="title">Affiliation</label>
                          <input type="text" class="form-control" id="affiliation"
                            placeholder="Fill in affiliation name" [(ngModel)]="modelLecture.affiliation"
                            name="affiliation" required (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                      <div class="col-md-3">
                        <div class="form-group">
                          <label for="eqf">EQF</label>
                          <span
                            tooltip="EQF concerns the level of what a learner knows, understands (knowledge) and is able to do (skills). It ranges from 1 (basic) to 8 (advanced)"
                            class="badge badge-primary badge-pill">i</span>
                          <a style="text-align: right" href="https://www.cedefop.europa.eu/en/events-and-projects/projects/european-qualifications-framework-eqf" target="_blank" >What is EQF?</a>
                          <input type="number" size="1" class="form-control" id="eqf" [(ngModel)]="modelLecture.eqf"
                            name="eqf" min="1" max="8" (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                      <div class="col-md-12">
                        <div class="form-group">
                          <!--  <label for="title">Affiliation webpage</label> -->
                          <input type="text" class="form-control" id="urlAff" placeholder="Fill in URL (to, e.g., official description, further information, ...)"
                            [(ngModel)]="modelLecture.urlAff" name="urlAff" (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                      <div class="col-md-12">
                        <div class="form-group">
                          <label for="field">Study areas </label>
                          <span
                            tooltip="The term relates directly to a specific area of study. The International Standard Classification of Education: Fields of Education and Training 2013 (ISCED-F). Maintained by the UNESCO Institute for Statistics."
                            class="badge badge-primary badge-pill">i</span>
                          <a href="https://circabc.europa.eu/sd/a/286ebac6-aa7c-4ada-a42b-ff2cf3a442bf/ISCED-F 2013 - Detailed field descriptions.pdf" target="_blank">What is a Study area?</a>
                          <ng-select [items]="fieldsService.allfields" name="fields" bindLabel="name"
                            groupBy="grandparent" [multiple]="true" [(ngModel)]="modelLecture.fields">
                            <ng-template ng-optgroup-tmp let-item="item">
                              {{item.grandparent || 'Unnamed group'}}
                            </ng-template>
                          </ng-select>
                        </div>
                      </div>
                      <div class="col-md-12" *ngIf="modelLecture.fields.length > 0">
                        <label for="numSemesters">Selected study areas ({{modelLecture.fields.length}})</label>
                        <ul>
                          <div *ngFor="let f of modelLecture.fields; index as i ">
                            <li>
                              <p>{{f.name}} ({{f.grandparent}}) <button type="button" class="btn btn-link btn-xs"
                                  (click)="modelLecture.fields.splice(i, 1); updateFields()" tooltip="Click to remove">
                                  <i class="fa fa-remove"></i>
                                </button></p>
                            </li>
                          </div>
                        </ul>
                      </div>
                      <div class="col-md-12">
                        <div class="form-group">
                          <label for="title">Associated training material</label>
                          <input type="text" class="form-control" id="urlTM" placeholder="Fill in the URL (to, e.g., learning platform, online syllabus, ...)"
                            [(ngModel)]="modelLecture.urlTM" name="urlTM" (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-9">
                        <div class="form-group">
                          <label for="description">Description</label>
                          <textarea class="form-control" id="description" name="description"
                            [(ngModel)]="modelLecture.description" rows="4"
                            placeholder="Add a short introduction and other information relevant to the lecture..."
                            (keyup)="updateTreeStudyProgram()"> </textarea>

                        </div>
                      </div>
                      <div class="col-md-3 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="reuseOrAnnotate='Re-use'; bokModal.show(); linkBoKto='description'">
                          Re-use BoK description
                        </button>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="ects">ECTS</label>
                          <span
                            tooltip="European Credit Transfer and Accumulation System (ECTS) is a standard means for comparing academic credits for higher education. One academic year corresponds to 60 ECTS credits that are normally equivalent to 1500â€“1800 hours of total workload."
                            class="badge badge-primary badge-pill">i</span>
                          <a style="text-align: right" href="https://ec.europa.eu/education/resources-and-tools/european-credit-transfer-and-accumulation-system-ects_en" target="_blank" >What is ECTS?</a>
                          <input type="number" class="form-control" id="ects" [(ngModel)]="modelLecture.ects"
                            name="ects" min="0" (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="isPractical">Is practical</label>
                          <span tooltip="Check this option if it is a practical lecture."
                            class="badge badge-primary badge-pill">i</span>
                          <label class="switch switch-pill switch-primary">
                            <input type="checkbox" name="isPractical" class="switch-input"
                              [(ngModel)]="modelLecture.isPractical">
                            <span class="switch-slider"></span>
                          </label>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-9">
                        <hr>
                        <div class="form-group">
                          <label for="title">
                            <button type="button" class="btn btn-link btn-xs"
                              (click)="showLectureLO.classList.contains('hidden') ? showLectureLO.className = 'row' : showLectureLO.className = 'row hidden' ">
                              <i [tooltip]="showLectureLO.classList.contains('hidden')? 'Show' : 'Hide'"
                                [ngClass]="showLectureLO.classList.contains('hidden')? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                            </button>
                            Learning Outcomes ({{modelLecture.learningObjectives.length}})</label>
                          <div class="row" #showLectureLO>
                            <div class="col-md-12">
                              <div *ngIf="modelLecture && modelLecture.learningObjectives">
                                <ul>
                                  <div *ngFor="let p of modelLecture.learningObjectives; index as i ">
                                    <li *ngIf="p.name == p.concept_id">{{p.name}} <button type="button" class="btn btn-link" tooltip="Click to remove"
                                                                                                       (click)="removeBokKnowledge(modelLecture, i, 'learningObjectives')">
                                      <i class="fa fa-remove"></i>
                                    </button></li>
                                    <li *ngIf="p.name != p.concept_id"> <a href="https://gistbok-bok.ucgis.org/{{p.concept_id}}"
                                                                                                                             target="_blank">{{p.name}}</a>
                                      <button type="button" class="btn btn-link" tooltip="Click to remove"
                                              (click)="removeBokKnowledge(modelLecture, i, 'learningObjectives')">
                                        <i class="fa fa-remove"></i>
                                      </button></li>
                                  </div>
                                </ul>
                              </div>
                              <div
                                *ngIf="!modelLecture.learningObjectives || modelLecture.learningObjectives.length == 0"
                                class="text-placeholder">
                                Explore the Body of Knowledge to add some or add custom learning outcomes.
                              </div>

                              <br>
                              <div class="row">
                                <div class="col-md-2"></div>
                                <div class="col-md-6">
                                  <input type="text" class="form-control" id="customLO" maxlength="150"
                                    placeholder="Add custom learning outcome" [(ngModel)]="customLO" name="customLO" />
                                </div>
                                <div class="col-md-4">
                                  <button type="button" class="btn btn-primary btn-sm" [disabled]="customLO.length < 1"
                                    (click)="addCustomLO(modelLecture)">
                                    Add custom LO
                                  </button>
                                </div>
                              </div>
                              <div style="text-align: center">
                                <a (click)="openModal(template)">Please see the guidelines to define skills</a>
                              </div>
                              <ng-template #template>
                                <div class="modal-primary ">
                                  <div class="modal-header">
                                    <h4 class="modal-title pull-left">Guidelines</h4>
                                    <button type="button" class="close pull-right" aria-label="Close"
                                      (click)="modalRef.hide()">
                                      <span aria-hidden="true">&times;</span>
                                    </button>
                                  </div>
                                  <div class="modal-body">
                                    <p style="text-align:justify;"> A learning outcome is a statement of what a learner
                                      knows, understands and is able to do on completion of a learning process (Source:
                                      European Commission)
                                      In the context of UCGIS, it is formulated as <strong> verb + (BoK) concept
                                        relevant statement </strong>, using active voice, by the use of verbs from the
                                      Bloom's revised taxonomy. <br>
                                      Some examples of learning outcomes associated to BoK concepts: </p>

                                    <p style="text-align:justify;"> <span>&#8226;</span> BoK ConceptÂ  - Learning outcome
                                      <br>
                                      <span>&#8226;</span> Spatial simulation modelling -Â Perform a simulation
                                      experiment using available simulation software <br>
                                      <span>&#8226;</span> Data model and format conversion - Convert a data set from
                                      the native format of one GIS product to another <br>
                                      <span>&#8226;</span> Vagueness -Â Evaluate vagueness in the locations, time,
                                      attributes, and other aspects of geographic phenomena </p>

                                    <table class="table">
                                      <thead>
                                        <tr>
                                          <th *ngFor="let tax of taxonomy"> {{tax.name}}</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        <ng-container *ngFor="let tax of taxonomy; index as a">
                                          <td>
                                            <tr *ngFor="let obj of tax.content; index as b">
                                              {{obj}}
                                            </tr>
                                          </td>
                                        </ng-container>
                                      </tbody>
                                    </table>
                                  </div>
                                </div>
                              </ng-template>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-3 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="reuseOrAnnotate='Re-use'; bokModal.show(); linkBoKto='learningObjectives'">
                          Re-use BoK learning outcomes
                        </button>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12">
                        <hr>
                        <label for="description">Transversal skills</label>
                      </div>
                      <div class="col-md-6">
                        <div class="input-group">
                          <ng-select *ngIf="isfullESCOcompetences" [items]="escoService.allcompetences"
                            name="competences" bindLabel="preferredLabel" groupBy="reuseLevel" [multiple]="true"
                            [searchFn]="customSearchFn" placeholder="Search..." [clearSearchOnAdd]="true"
                            [(ngModel)]="modelLecture.competences" [clearable]="false"
                            (change)="updateTreeStudyProgram()">
                            <ng-template ng-optgroup-tmp let-item="item">
                              {{item.reuseLevel || 'Unnamed group'}}
                            </ng-template>
                          </ng-select>
                          <ng-select *ngIf="!isfullESCOcompetences" [items]="competences" name="competences"
                            bindLabel="preferredLabel" groupBy="reuseLevel" [multiple]="true"
                            [searchFn]="customSearchFn" placeholder="Search..." [clearSearchOnAdd]="true"
                            [(ngModel)]="modelLecture.competences" [clearable]="false"
                            (change)="updateTreeStudyProgram()">
                            <ng-template ng-optgroup-tmp let-item="item">
                              {{item.reuseLevel || 'Unnamed group'}}
                            </ng-template>
                          </ng-select>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <span class="input-group-prepend">
                          <label class="switch switch-label switch-pill switch-outline-primary-alt">
                            <input class="switch-input" type="checkbox" value="isfullESCOcompetences"
                              [(ngModel)]="isfullESCOcompetences" checked />
                            <span class="switch-slider"
                              tooltip="Click here to add to the dropdown full list of ESCO skills." data-checked="âœ“"
                              data-unchecked="X"></span>
                          </label>
                          <div class="pl-1">Search full <a href="https://ec.europa.eu/esco/portal/skill"
                              target="_blank">ESCO</a>
                            skills
                          </div>
                        </span>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12">
                        <ul>
                          <div *ngFor="let mc of modelLecture.competences; index as i ">
                            <li *ngIf="!mc.uri">{{ mc.preferredLabel }}
                              <button type="button" class="btn btn-link" tooltip="Click to remove"
                                (click)="removeCompetence(mc, modelLecture.competences)">
                                <i class="fa fa-remove"></i>
                              </button></li>
                            <li *ngIf="mc.uri && mc.uri != ''"> <a href="{{mc.uri}}"
                                target="_blank">{{ mc.preferredLabel }} </a>
                              <button type="button" class="btn btn-link" tooltip="Click to remove"
                                (click)="removeCompetence(mc, modelLecture.competences)">
                                <i class="fa fa-remove"></i>
                              </button></li>
                          </div>
                        </ul>
                      </div>
                    </div>
                    <div class="row pt-1">
                      <div class="col-md-12">

                        This service uses the <a href="http://ec.europa.eu/esco" target="_blank"> ESCO </a>
                        classification of the
                        European Commission. <br> If you cannot find the specified transversal skill, you can also add
                        your own here:

                      </div>
                    </div>
                    <div class="row pt-1 form-group">
                      <div class="col-md-6">
                        <input #competenceExtra type="text" class="form-control" id="competenceExtra"
                          placeholder="Custom transversal skill" name="competenceExtra"
                          (keyup)="competenceExtraAdd.disabled = false" maxlength="150"
                          (keydown.enter)="addExtraCompetence(competenceExtra.value, modelLecture); competenceExtra.value= ''; competenceExtraAdd.disabled = true" />
                      </div>
                      <div class="col-md-6">
                        <button #competenceExtraAdd type="submit" class="btn btn-primary btn-sm"
                          tooltip="Add your custom transversal skill."
                          (click)="addExtraCompetence(competenceExtra.value, modelLecture); competenceExtra.value= ''; competenceExtraAdd.disabled = true"
                          disabled>
                          Add custom transversal skill
                        </button>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-9">
                        <hr>
                        <div class="form-group">
                          <label for="bibliography">Bibliography</label>
                          <span
                            tooltip="APA style. Example: Walford, N. (2002). Geographical data: Characteristics and sources. Chilchester: Wiley. ISBN: 9780471970859. DOI: https://doi.org/10.1046/j.0031-868X.2003.024_03.x"
                            class="badge badge-primary badge-pill">i</span>
                          <div class="row">
                            <div class="col-md-12">
                              <div *ngIf="modelLecture && modelLecture.bibliography">
                                <ul>
                                  <div *ngFor="let b of modelLecture.bibliography; index as i ">
                                    <li>{{b.name}} <button type="button" class="btn btn-link" tooltip="Click to remove"
                                        (click)="removeBokKnowledge(modelLecture, i, 'bibliography')">
                                        <i class="fa fa-remove"></i>
                                      </button></li>
                                  </div>
                                </ul>
                              </div>
                              <div *ngIf="!modelLecture.bibliography || modelLecture.bibliography.length == 0"
                                class="text-placeholder">
                                Explore the Body of Knowledge to add some bibliography or add your own.
                              </div>

                            </div>
                            <div class="col-md-8">
                              <input type="text" class="form-control" id="bibliography" placeholder="Bibliography"
                                [(ngModel)]="customBib" name="bibliography" maxlength="150" />
                            </div>
                            <div class="col-md-4">
                              <button type="button" class="btn btn-primary btn-sm" (click)="addCustomBib(modelLecture)"
                                [disabled]="customBib.length < 1">
                                Add custom Bibliography
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-3 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="reuseOrAnnotate='Re-use'; bokModal.show(); linkBoKto='bibliography'">
                          Re-use BoK bibliography
                        </button>
                      </div>

                    </div>
                  </div>
                </div>
                <!--    </form> -->
              </div>

              <!-- Existing modules, courses and lectures -->
              <div *ngIf="isSearchingExisting && !isSearchingSpecific">
                <div class="card card-accent-secondary">
                  <div class="card-header">
                    Explore existing educational offers
                    <!--  {{textByDepth}}s -->
                    <span
                      tooltip="These items have been added by other user, and can be re-used in your educational offer."
                      class="badge badge-primary badge-pill">i</span>
                    <button class="btn btn-link float-right pull-right"
                      (click)="NodeDiv.classList.contains('col-md-12') ? NodeDiv.className = 'col-md-6' : NodeDiv.className = 'col-md-12'">
                      <i class="float-right pull-right fa "
                        [ngClass]="{'fa-window-minimize': NodeDiv?.classList.contains('col-md-12'), 'fa-window-maximize': NodeDiv?.classList.contains('col-md-6')}"></i>
                    </button>
                  </div>
                  <div class="card-body" style="background-color: #faf9f8">
                    <div class="row">
                      <div class="col-md-12">
                        <div class="form-group">
                          <div class="text-center">
                            <button class="btn btn-pill btn-outline-primary" [ngClass]="{'active': depthSearching==1}"
                              [disabled]="currentTreeNode.depth>0" [hidden]="highestItemLevel >= 1"
                              (click)="depthSearching=1">Modules</button>
                            <button class="btn btn-pill btn-outline-primary" [ngClass]="{'active': depthSearching==2}"
                              [disabled]="currentTreeNode.depth>1" [hidden]="highestItemLevel >= 2"
                              (click)="depthSearching=2">Courses</button>
                            <button class="btn btn-pill btn-outline-primary" [ngClass]="{'active': depthSearching==3}"
                              [disabled]="currentTreeNode.depth>2" [hidden]="highestItemLevel >= 3"
                              (click)="depthSearching=3">Lectures</button>
                            <button class="btn btn-link pull-right"
                              (click)="isSearchingExisting = !isSearchingExisting"><i class="fa fa-times"></i>
                              Close</button>
                          </div>
                          <br>
                          <label for="title">Filter items by name</label> <!-- {{textByDepth}}  -->
                          <input type="text" class="form-control" id="filterText" placeholder="Type to filter"
                            [(ngModel)]="filterText" name="filterText" />
                        </div>
                      </div>
                    </div>
                    <ul>
                      <div *ngFor="let i of (allItems| filter:filterText); index as in">
                        <li *ngIf="i.depth==depthSearching"><a class="card-title"
                            (click)="showExistingToStudyProgram(i); isSearchingSpecific = !isSearchingSpecific; isSearchingExisting = !isSearchingExisting">{{ i.name }}</a>
                          <h6 *ngIf="i.affiliation != ''" class="text-muted inline"> - {{ i.affiliation }}</h6>
                          <h6 *ngIf="i.eqf != 0" class="text-muted inline"> - EQF: {{ i.eqf }}</h6>
                        </li>
                      </div>
                    </ul>
                  </div>
                </div>
              </div>

              <!-- Show specific existing module -->
              <div *ngIf="isSearchingSpecific && !isSearchingExisting">
                <div class="card card-accent-secondary">
                  <div class="card-header">
                    <h5>{{currentStudyProgram.name}}</h5>
                    <span
                      tooltip="This item has been added by other user, and can be re-used in your educational offer."
                      class="badge badge-primary badge-pill">i</span>
                    <button class="btn btn-link float-right pull-right"
                      (click)="NodeDiv.classList.contains('col-md-12') ? NodeDiv.className = 'col-md-6' : NodeDiv.className = 'col-md-12'">
                      <i class="float-right pull-right fa "
                        [ngClass]="{'fa-window-minimize': NodeDiv?.classList.contains('col-md-12'), 'fa-window-maximize': NodeDiv?.classList.contains('col-md-6')}"></i>
                    </button>
                  </div>
                  <div class="card-body" style="background-color: #faf9f8">
                    <div class="row">
                      <div class="col-md-12">
                        <div class="form-group">
                          <button type="submit" class="btn btn-link"
                            (click)="isSearchingSpecific = false; isSearchingExisting = !isSearchingExisting">
                            <i class="fa fa-arrow-left"></i> Back
                          </button>
                          <h4 *ngIf="depthSearching==1"> Module: {{ currentStudyProgram.name }} </h4>
                          <h4 *ngIf="depthSearching==2"> Course: {{ currentStudyProgram.name }} </h4>
                          <h4 *ngIf="depthSearching==3"> Lecture: {{ currentStudyProgram.name }} </h4>
                          <div *ngIf="currentStudyProgram.fields && currentStudyProgram.fields.length > 0">
                            <p><b> Study areas ({{currentStudyProgram.fields.length}}) </b> </p>
                          </div>
                          <ul>
                            <div *ngFor="let f of currentStudyProgram.fields; index as i ">
                              <li>
                                <p>{{f.name}} ({{f.grandparent}})</p>
                              </li>
                            </div>
                          </ul>
                          <p class="text-justify">{{ currentStudyProgram.description }}</p>
                          <div *ngIf="currentStudyProgram.numSemester">
                            <p><b> In semester:</b> {{ currentStudyProgram.numSemester }}</p>
                          </div>
                          <div *ngIf="currentStudyProgram.ects">
                            <p><b> ECTS:</b> {{ currentStudyProgram.ects }}</p>
                          </div>
                          <div *ngIf="currentStudyProgram.assessment">
                            <p><b>Assessment:</b> {{ currentStudyProgram.assessment }}</p>
                          </div>
                          <div *ngIf="currentStudyProgram.bibliography">
                            <p><b>Bibliography:</b> {{ currentStudyProgram.bibliography }}</p>
                          </div>
                          <div *ngIf="currentStudyProgram.sourceDocs">
                            <p><b>Bibliography:</b> {{ currentStudyProgram.sourceDocs }}</p>
                          </div>
                          <div
                            *ngIf="currentStudyProgram.prerequisites && currentStudyProgram.prerequisites.length > 0">
                            <span><b>Prerequisites</b></span>
                            <ul>
                              <div *ngFor="let p of currentStudyProgram.prerequisites">
                                <li>{{ p.name }}</li>
                              </div>
                            </ul>
                          </div>
                          <div
                            *ngIf="currentStudyProgram.learningObjectives && currentStudyProgram.learningObjectives.length > 0">
                            <span><b>Learning Outcomes:</b></span>
                            <ul>
                              <div *ngFor="let l of currentStudyProgram.learningObjectives">
                                <li>{{ l.name }}</li>
                              </div>
                            </ul>
                          </div>
                          <div *ngIf="currentStudyProgram.children && currentStudyProgram.children.length > 0">
                            <b>Child nodes that will also be included: </b>
                            <div *ngFor="let l of currentStudyProgram.children" style="padding-left: 1em;">
                              - {{ l.name }}
                            </div>
                          </div>
                          <button type="submit" class="btn btn-pill btn-primary pull-right"
                            (click)="addExistingToStudyProgram(currentStudyProgram)">
                            <i class="fa fa-plus"></i> Add to my educational offer
                          </button>

                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="!currentTreeNode" class="col-md-12">
          <div class="card card-accent-secondary">
            <div class="card-body" style="background-color: #faf9f8">
              <div class="row">
                <div class="col-md-12">
                  <app-how></app-how>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
    <!--/.col-->
  </div>
  <!--/.row-->
</div>

<div bsModal #bokModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-secondary modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Re-use BoK content and Annotate BoK concepts to your educational offer.</h4>
        <button type="button" class="close" (click)="bokModal.hide()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <!-- Search Knowledge and skills card  [hidden]="!isDisplayBoK" -->
        <div class="card card-accent-secondary">
          <div class="card-header">
            Body of Knowledge - Search knowledge and skills
            <span
              tooltip="Browse in the BoK for knowledge required for your new educational offer. Once in the required knowledge, press the button 'Add' it will link the concept and the learning outcomes dependent on it."
              class="badge badge-primary badge-pill">i</span>
          </div>

          <div class="card-body" style="background-color: #faf9f8">
            <div class="row text-center">
              <div class="col-lg-6 col-sm-6">
                <div class="row text-center">
                  <div class="col-md-12">
                    <div class="input-group">
                      <div class="input-group-prepend" dropdown>
                        <button type="button" class="btn btn-primary">
                          <i class="fa fa-search"></i>
                        </button>
                      </div>
                      <input #searchInput type="text" id="input-competence-filter" name="input-competence-filter"
                        class="form-control" [(ngModel)]="searchInputField" (keyup)="searchInBok(searchInput.value)"
                        placeholder="Search Knowledge" />
                    </div>
                  </div>
                </div>
                <div id="graph">
                </div>
              </div>
              <div class="col-lg-6 col-sm-6 text-justify">
                <div class="row text-left">
                  <div class="col-md-6">
                    <a (click)="hasResults = !hasResults; currentConcept=''"
                      *ngIf="!hasResults && currentConcept != 'UCGIS'">
                      < Back to search results </a>
                  </div>
                  <div class="col-md-6">
                    <a (click)="hasResults = false; cleanResults()" *ngIf="hasResults">
                      &nbsp; X Clear search results </a>
                  </div>
                </div>
                <br>
                <h5 [hidden]="currentConcept == '' && currentConcept != 'UCGIS'">Knowledge</h5>
                <div #textInfo id="textInfo" [hidden]="hasResults">
                </div>
                <div class="col" *ngIf="hasResults">
                  <h3 class="center">
                    {{ selectedNodes.length }} result(s) for
                    {{ searchInput.value }}
                  </h3>
                  <div *ngFor="let item of selectedNodes; index as i">
                    <div *ngIf="i < limitSearchTo && i >= limitSearchFrom">
                      <div class="inline">{{ item.nameShort }}</div>
                      <div class="inline" [innerHTML]="
                            item.name | truncate: 100:searchInput.value
                          "></div>
                      <a class="inline" (click)="navigateToConcept(item.nameShort)">
                        Details
                      </a>
                      <div class="small" [innerHTML]="
                            item.description | truncate: 100:searchInput.value
                          "></div>
                    </div>
                  </div>
                  <div>
                    <br />
                    <div class="row">
                      <div class="col-md-6 text-right">
                        <a *ngIf="limitSearchFrom > 0" (click)="decrementLimit()">
                          << Previous </a>
                      </div>
                      <div class="col-md-6 text-left"> <a *ngIf="limitSearchTo < selectedNodes.length"
                          (click)="incrementLimit()">
                          Next >>
                        </a></div>
                    </div>

                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="addBokKnowledge()"> {{reuseOrAnnotate}}</button>
        <button type="button" class="btn btn-danger" (click)="bokModal.hide()">Close</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
